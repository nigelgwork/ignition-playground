name: "Gateway Login"
version: "1.2"
description: "Visual login test: Open gateway webpage, login with credentials (two-step with Continue button), verify successful authentication"

parameters:
  - name: gateway_url
    type: string
    required: true
    default: "http://localhost:8088"
    description: "Gateway URL (e.g., http://localhost:8088)"

  - name: username
    type: string
    required: true
    description: "Gateway username"

  - name: password
    type: string
    required: true
    description: "Gateway password"

steps:
  - id: step1
    name: "Step 1: Open Gateway Webpage"
    type: browser.navigate
    parameters:
      url: "{{ gateway_url }}"
    timeout: 30

  - id: step2
    name: "Step 2: Click Login Button"
    type: browser.click
    parameters:
      selector: "a.login-link, a[href*='login'], button.login-button, #login-button, [data-testid='login'], nav a:has-text('Login')"
    timeout: 10

  - id: step3
    name: "Step 3: Wait for login form"
    type: browser.wait
    parameters:
      selector: "input[name='j_username'], input[name='username'], input[type='text']"
    timeout: 10

  - id: step4
    name: "Step 4: Enter Username"
    type: browser.fill
    parameters:
      selector: "input[name='j_username'], input[name='username'], input[type='text'], input[placeholder*='username' i]"
      value: "{{ username }}"
    timeout: 10

  - id: step5
    name: "Step 5: Capture page after username entry"
    type: browser.screenshot
    parameters:
      path: "after_username_entry.png"
    timeout: 10

  - id: step6
    name: "Step 6: Click Continue Button"
    type: browser.click
    parameters:
      selector: "text='CONTINUE'"
    timeout: 10
    retry_count: 3

  - id: step7
    name: "Step 7: Enter Password"
    type: browser.fill
    parameters:
      selector: "input[name='j_password'], input[name='password'], input[type='password']"
      value: "{{ password }}"
    timeout: 10

  - id: step8
    name: "Step 8: Click Continue Button (After Password)"
    type: browser.click
    parameters:
      selector: "text='CONTINUE'"
    timeout: 10
    retry_count: 3

  - id: step9
    name: "Step 9: Wait for Dashboard"
    type: browser.wait
    parameters:
      selector: ".home-page, .ia_homePage, [data-page='home'], nav"
    timeout: 15

  - id: step10
    name: "Step 10: Check License Status (Optional)"
    type: browser.click
    parameters:
      selector: "a[href*='license'], a:has-text('Licensing'), nav a:has-text('Config'), .ia-navList a[href='/web/config/system.license']"
    timeout: 10
    on_failure: continue

  - id: step11
    name: "Step 11: Wait for License Page (Optional)"
    type: browser.wait
    parameters:
      selector: ".license-info, [data-page='license'], .ia-licenseStatus, h2:has-text('License')"
    timeout: 10
    on_failure: continue

  - id: step12
    name: "Step 12: Check for Trial Reset Warning (Optional)"
    type: browser.verify
    parameters:
      selector: "text=/trial.*reset/i, .warning:has-text('trial'), .alert:has-text('trial'), [class*='trial']"
      exists: false
    timeout: 5
    on_failure: continue

  - id: step13
    name: "Step 13: Capture License Screenshot (Optional)"
    type: browser.screenshot
    parameters:
      path: "gateway_license_status.png"
    timeout: 10
    on_failure: continue
