name: "Reset Gateway Trial"
version: "2.0"
description: "Login to Ignition Gateway and reset the trial license by clicking the reset button if needed"

parameters:
  - name: gateway_url
    type: string
    required: true
    description: "Gateway URL (e.g., http://localhost:8088)"

  - name: username
    type: string
    required: true
    description: "Gateway admin username"

  - name: password
    type: string
    required: true
    description: "Gateway admin password"

steps:
  - id: step1
    name: "Step 1: Execute Gateway Login Playbook"
    type: playbook.run
    parameters:
      playbook: "gateway/gateway_login.yaml"
      gateway_url: "{{ parameter.gateway_url }}"
      username: "{{ parameter.username }}"
      password: "{{ parameter.password }}"
    on_failure: abort

  - id: step2
    name: "Step 2: Navigate to Licensing Page"
    type: browser.navigate
    parameters:
      url: "{{ parameter.gateway_url }}/app/platform/system/licensing"
    timeout: 10

  - id: step3
    name: "Step 3: Wait for Licensing Page to Load"
    type: browser.wait
    parameters:
      selector: "h1, h2, .trial, [class*='license'], [class*='trial']"
    timeout: 10

  - id: step4
    name: "Step 4: Check Trial Status Box"
    type: browser.screenshot
    parameters:
      path: "trial_status_check.png"
    timeout: 10

  - id: step5
    name: "Step 5: Look for Reset Button (Yellow Box)"
    type: browser.wait
    parameters:
      selector: "button:has-text('Reset'), button:has-text('reset'), [class*='reset'], button[onclick*='reset']"
    timeout: 5
    on_failure: continue

  - id: step6
    name: "Step 6: Click Reset Activation Time Button"
    type: browser.click
    parameters:
      selector: "button:has-text('Reset'), button:has-text('reset'), [class*='reset']"
    timeout: 10
    on_failure: continue

  - id: step7
    name: "Step 7: Wait for Blue Box with Activate Ignition Button"
    type: browser.wait
    parameters:
      selector: "button:has-text('Activate'), button:has-text('activate'), [class*='activate']"
    timeout: 10

  - id: step8
    name: "Step 8: Verify Trial Mode Active (Blue Box)"
    type: browser.screenshot
    parameters:
      path: "trial_mode_active.png"
    timeout: 10

  - id: step9
    name: "Step 9: Confirm Trial Reset Complete"
    type: utility.log
    parameters:
      message: "Trial reset complete. Blue Activate Ignition button is visible, indicating trial mode is active."
      level: "info"
