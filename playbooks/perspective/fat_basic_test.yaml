name: "Perspective FAT - Basic Component Discovery"
version: "1.0"
description: "Simple FAT test - discovers components and generates basic test report (no AI required)"
domain: perspective
verified: false

parameters:
  - name: perspective_url
    type: string
    required: true
    description: "Perspective session URL to test"

  - name: project_name
    type: string
    required: true
    description: "Project name for report"

steps:
  # ==========================================================================
  # STEP 1: Navigate to page
  # ==========================================================================
  - id: step1_navigate
    name: "Step 1: Navigate to Perspective Page"
    type: browser.navigate
    parameters:
      url: "{{ parameter.perspective_url }}"
      wait_until: "networkidle"

  # ==========================================================================
  # STEP 2: Capture screenshot
  # ==========================================================================
  - id: step2_screenshot
    name: "Step 2: Capture Screenshot"
    type: browser.screenshot
    parameters:
      name: "fat_basic_{{ parameter.project_name }}"
      full_page: true

  # ==========================================================================
  # STEP 3: Discover components
  # ==========================================================================
  - id: step3_discover
    name: "Step 3: Discover Interactive Components"
    type: perspective.discover_page
    parameters:
      selector: "body"
      types: []  # Empty = discover all types

  # ==========================================================================
  # STEP 4: Extract metadata
  # ==========================================================================
  - id: step4_extract
    name: "Step 4: Extract Component Metadata"
    type: perspective.extract_component_metadata
    parameters:
      components: "{{ step.step3_discover.inventory }}"

  # ==========================================================================
  # STEP 5: Generate basic test plan (without AI)
  # ==========================================================================
  - id: step5_generate_tests
    name: "Step 5: Generate Basic Test Plan"
    type: ai.generate_test_cases
    parameters:
      components: "{{ step.step4_extract.enriched_inventory }}"
      mode: "comprehensive"
    on_failure: continue

  # ==========================================================================
  # STEP 6: Execute tests
  # ==========================================================================
  - id: step6_execute
    name: "Step 6: Execute Component Tests"
    type: perspective.execute_test_manifest
    parameters:
      manifest: "{{ step.step5_generate_tests.test_plan }}"
      capture_screenshots: true
      on_failure: "continue"
      return_to_baseline: true
      baseline_url: "{{ parameter.perspective_url }}"
    timeout: 300

  # ==========================================================================
  # STEP 7: Generate report
  # ==========================================================================
  - id: step7_report
    name: "Step 7: Generate FAT Report"
    type: fat.generate_report
    parameters:
      test_results: "{{ step.step6_execute }}"
      format: "html"
      metadata:
        project_name: "{{ parameter.project_name }}"
        test_date: "{{ execution.started_at }}"
        perspective_url: "{{ parameter.perspective_url }}"

  # ==========================================================================
  # STEP 8: Summary
  # ==========================================================================
  - id: step8_summary
    name: "Step 8: Test Summary"
    type: utility.log
    parameters:
      message: |
        FAT Test Complete: {{ parameter.project_name }}
        Components: {{ step.step3_discover.count }}
        Tests: {{ step.step6_execute.total }}
        Passed: {{ step.step6_execute.passed }}
        Failed: {{ step.step6_execute.failed }}
        Report: {{ step.step7_report.report_path }}
      level: "info"

metadata:
  author: "Ignition Automation Toolkit"
  category: "perspective"
  tags: ["FAT", "basic", "no-ai"]
